---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import FormattedDate from "../components/FormattedDate.astro";

type Props = CollectionEntry<"blog">["data"];
const site = Astro.site;
const { title, description, pubDate, updatedDate, heroImage, heroImageSource } =
    Astro.props;
const ogImage = heroImage ? new URL(heroImage, site).toString() : undefined;
---

<html lang="en">
    <head>
        <BaseHead title={title} description={description} image={ogImage} />
    </head>

    <body>
        <main class="content-wrapper">
            <nav class="back-nav">
                <a href="/" class="back-link">← Home</a>
            </nav>

            <article class="prose">
                <header class="article-header">
                    <div class="article-meta">
                        <FormattedDate date={pubDate} />
                        {
                            updatedDate && (
                                <span class="last-updated-on">
                                    · Updated{" "}
                                    <FormattedDate date={updatedDate} />
                                </span>
                            )
                        }
                    </div>
                    <h1 class="title">{title}</h1>

                    {description && <p class="description">{description}</p>}
                    <hr />
                </header>
                {
                    heroImage && (
                        <figure class="hero-image">
                            <div class="hero-frame">
                                <img
                                    src={heroImage}
                                    alt={title}
                                    loading="eager"
                                    decoding="async"
                                />
                            </div>

                            {heroImageSource && (
                                <figcaption class="hero-source">
                                    source: {heroImageSource}
                                </figcaption>
                            )}
                        </figure>
                    )
                }

                <div class="article-content">
                    <slot />
                </div>
            </article>

            <footer class="article-footer">
                <a href="/blog" class="back-link">← All posts</a>
            </footer>
        </main>
    </body>
</html>

<style>
    .content-wrapper {
        max-width: 720px;
        margin: 0 auto;
        padding: var(--space-8) var(--space-6) var(--space-16);
    }

    .back-nav {
        margin-bottom: var(--space-8);
    }

    .back-link {
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-muted);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .back-link:hover {
        color: var(--color-accent);
    }

    .prose {
        max-width: 100%;
    }

    .article-header {
        margin-bottom: var(--space-8);
    }

    .title {
        margin-bottom: var(--space-2);
        line-height: 1.1;
    }

    .description {
        font-size: 1.2rem;
        color: var(--color-text-muted);
        line-height: 1.4;
        margin-bottom: var(--space-4);
    }

    .article-meta {
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-text-subtle);
        margin-bottom: var(--space-4);
    }

    .last-updated-on {
        font-style: italic;
    }

    hr {
        border: 0;
        border-top: 1px solid var(--color-border);
        margin: var(--space-6) 0;
    }

    .article-footer {
        margin-top: var(--space-12);
        padding-top: var(--space-6);
        border-top: 1px solid var(--color-border);
    }

    .hero-image {
        margin: var(--space-8) 0 var(--space-10);
        display: flex;
        flex-direction: column !important;
        justify-content: center;
        align-items: start;
    }

    .hero-frame {
        width: 100%;
        max-width: 720px;
        aspect-ratio: 16 / 9;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border-radius: 6px;
    }

    .hero-frame img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block;
    }

    .hero-source {
        margin-top: var(--space-2);
        font-family: var(--font-mono);
        font-size: 0.75rem;
        color: var(--color-text-subtle);
        text-align: right;
    }

    @media (max-width: 768px) {
        .content-wrapper {
            padding: var(--space-6) var(--space-4);
        }
    }
</style>
